datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  passwordHash  String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  groups        Group[]   @relation("GroupOwner")
}

model Group {
  id            String        @id @default(cuid())
  name          String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  ownerId       String
  owner         User          @relation("GroupOwner", fields: [ownerId], references: [id])
  participants  Participant[]
  expenses      Expense[]
}

model Participant {
  id            String         @id @default(cuid())
  name          String
  // Optional: functionality to link a participant to a real user account in the future
  // userId        String?
  groupId       String
  group         Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  splits        ExpenseSplit[]
  expensesPaid  Expense[]
}

model Expense {
  id                  String         @id @default(cuid())
  description         String
  amount              Float
  date                DateTime
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  groupId             String
  group               Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  paidByParticipantId String
  paidBy              Participant    @relation(fields: [paidByParticipantId], references: [id])
  splitMode           SplitMode
  splits              ExpenseSplit[]
}

model ExpenseSplit {
  id            String      @id @default(cuid())
  expenseId     String
  expense       Expense     @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  participantId String
  participant   Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)
  shareAmount   Float
}

enum SplitMode {
  EQUAL
  EXACT
  PERCENT
}
