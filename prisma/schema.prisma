datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String            @id @default(cuid())
  clerkId       String            @unique // Link to Clerk
  email         String            @unique
  name          String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  groups        Group[]           @relation("GroupOwner")
  expenses      PersonalExpense[] // Personal expenses
}

model Group {
  id            String        @id @default(cuid())
  name          String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  ownerId       String
  owner         User          @relation("GroupOwner", fields: [ownerId], references: [id])
  participants  Participant[]
  expenses      Expense[]
}

model Participant {
  id           String         @id @default(cuid())
  name         String
  groupId      String
  group        Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  splits       ExpenseSplit[]
  expensesPaid Expense[]
}

model Expense {
  id                  String         @id @default(cuid())
  description         String
  amount              Float
  date                DateTime
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  groupId             String
  group               Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  paidByParticipantId String
  paidBy              Participant    @relation(fields: [paidByParticipantId], references: [id])
  splitMode           SplitMode
  splits              ExpenseSplit[]
}

model ExpenseSplit {
  id            String      @id @default(cuid())
  expenseId     String
  expense       Expense     @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  participantId String
  participant   Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)
  shareAmount   Float
}

model PersonalExpense {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amount      Float
  category    Category
  description String
  date        DateTime
  paymentMode String   @default("UPI") // UPI, Cash, Card
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum SplitMode {
  EQUAL
  EXACT
  PERCENT
}

enum Category {
  Food
  Travel
  Rent
  Shopping
  Bills
  Misc
}
